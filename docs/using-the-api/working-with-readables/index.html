<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.76.4" /><META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon"  href="/spotfire-mods/favicons/favicon.ico" >


<title>Working with mod readers | Spotfire® Mods</title><meta property="og:title" content="Working with mod readers" />
<meta property="og:description" content="This document gives an introduction to the mod [reader](/spotfire-mods/api-docs/interfaces/Reader.html).
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/spotfire-mods/docs/using-the-api/working-with-readables/" />
<meta property="article:published_time" content="2020-11-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-11-13T00:00:00+00:00" /><meta property="og:site_name" content="Spotfire® Mods" />
<meta itemprop="name" content="Working with mod readers">
<meta itemprop="description" content="This document gives an introduction to the mod [reader](/spotfire-mods/api-docs/interfaces/Reader.html).
">
<meta itemprop="datePublished" content="2020-11-13T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-11-13T00:00:00+00:00" />
<meta itemprop="wordCount" content="1372">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Working with mod readers"/>
<meta name="twitter:description" content="This document gives an introduction to the mod [reader](/spotfire-mods/api-docs/interfaces/Reader.html).
"/>





<link rel="preload" href="/spotfire-mods/scss/main.min.4c0876a5047f52f890950d4c0e413f53fa251e7d913cd2e6f0bf3cd510821323.css" as="style">
<link href="/spotfire-mods/scss/main.min.4c0876a5047f52f890950d4c0e413f53fa251e7d913cd2e6f0bf3cd510821323.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>




    <title>Working with mod readers | Spotfire® Mods</title>
  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/spotfire-mods/">
		<span class="navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 260 26"><polygon points="0 2.142 0 4.631 6.756 4.631 6.756 21.582 9.347 21.582 9.347 4.631 16.103 4.631 16.103 2.142 0 2.142" style="fill:#fff"/><rect x="19.187" y="2.142" width="2.592" height="19.44" style="fill:#fff"/><path d="M36.147 11.567c2.16-.809 3.3-2.271 3.3-4.262.0-3.048-2.066-5.163-6.725-5.163H26.337v19.44h6.571c4.967.0 7.157-2.208 7.157-5.5C40.065 13.9 38.708 12.22 36.147 11.567zm-7.188-7h3.98c2.53.0 3.887 1.089 3.887 2.955.0 1.9-1.512 3.142-4.288 3.142H28.959zm4.2 14.589h-4.2v-6.1h3.795c2.715.0 4.689.808 4.689 3.048C37.443 18.13 36.024 19.157 33.155 19.157z" style="fill:#fff"/><path d="M51.947 19.685c-4.226.0-7.065-3.08-7.065-7.9s2.808-7.745 7-7.745A8.985 8.985.0 0157.16 5.688l.833-2.395a12.063 12.063.0 00-6.108-1.618c-5.614.0-9.656 4.044-9.656 10.234s4.011 10.14 9.656 10.14a11.586 11.586.0 005.954-1.617l-.432-2.644A9.259 9.259.0 0151.947 19.685z" style="fill:#fff"/><path d="M72.987 2.562c-2.52 4.872-7.1 10.667-13.159 13.964a9.246 9.246.0 001.314 2.139A40.1 40.1.0 0073.879 3.047 8.9 8.9.0 0072.987 2.562z" style="fill:#fff"/><path d="M68.57 1.618c-5.668.0-9.672 4.41-9.672 10.218a12.52 12.52.0 00.3 2.765c5.8-2.383 10.95-7.636 13.562-12.143A10.369 10.369.0 0068.57 1.618z" style="fill:#fff"/><path d="M74.1 3.184A47.341 47.341.0 0162.87 20.264a9.823 9.823.0 005.7 1.7c5.668.0 9.671-4.442 9.671-10.25C78.241 7.863 76.661 4.878 74.1 3.184z" style="fill:#fff"/><path d="M188.584.0a2.514 2.514.0 00-2.49 2.525V2.54a2.49 2.49.0 104.979-.015V2.511A2.493 2.493.0 00188.584.0zm2.2 2.525a2.2 2.2.0 11-4.407.015V2.525a2.2 2.2.0 114.407-.014zm-1.059-.52c0-.533-.414-.807-.973-.807H187.61V3.751h.487v-.88h.53l.6.88h.586l-.673-.966A.768.768.0 00189.728 2.005zm-1.015.462H188.1V1.631h.616c.329.0.515.144.515.418C189.228 2.294 189.042 2.467 188.713 2.467z" style="fill:#fff"/><polygon points="212.126 2.128 204.004 13.953 195.856 2.128 194.975 2.128 194.975 21.558 195.883 21.558 195.883 3.765 203.95 15.424 204.004 15.424 212.071 3.765 212.071 21.558 213.007 21.558 213.007 2.128 212.126 2.128" style="fill:#fff"/><path d="M223.551 7.235a7.174 7.174.0 00-7.213 7.328v.056a7.186 7.186.0 1014.371-.056v-.055A7.1 7.1.0 00223.551 7.235zm6.222 7.356a6.24 6.24.0 11-12.472.0v-.056A6.212 6.212.0 01223.5 8.068a6.315 6.315.0 016.278 6.467z" style="fill:#fff"/><path d="M245.822 1.3V11.371a6.47 6.47.0 00-6.139-4.136 6.981 6.981.0 00-6.855 7.3v.056a6.965 6.965.0 006.855 7.3 6.532 6.532.0 006.139-4.192v3.858h.881V1.3zm.055 13.3a6.225 6.225.0 01-6.111 6.44c-3.442.0-6-2.776-6-6.468v-.055c0-3.748 2.5-6.412 6-6.412a6.242 6.242.0 016.111 6.439z" style="fill:#fff"/><path d="M255.182 13.98c-2.257-.638-4.212-1.277-4.212-3.025V10.9c0-1.554 1.514-2.748 3.8-2.748a7.831 7.831.0 014.4 1.471l.5-.749A8.96 8.96.0 00254.8 7.318c-2.836.0-4.735 1.583-4.735 3.664v.056c0 2.332 2.23 3.053 4.817 3.8 2.12.583 4.213 1.194 4.213 3.164v.056c0 1.721-1.735 2.914-3.965 2.914a8.474 8.474.0 01-5.176-1.915l-.523.694a9.1 9.1.0 005.644 2.054c2.781.0 4.928-1.527 4.928-3.83v-.056C260 15.479 257.715 14.674 255.182 13.98z" style="fill:#fff"/><path d="M94.3 10.788c-4.239-.916-5.231-1.943-5.231-3.775V6.957c0-1.748 1.6-3.136 4.1-3.136A8.425 8.425.0 0198.73 5.93L1e2 4.237A10 10 0 0093.223 1.85c-3.661.0-6.332 2.248-6.332 5.3v.055c0 3.193 2.038 4.636 6.47 5.608 4.047.86 5.011 1.887 5.011 3.691v.056c0 1.915-1.707 3.3-4.3 3.3a9.139 9.139.0 01-6.607-2.748l-1.349 1.61A11.224 11.224.0 0094 21.836c3.826.0 6.579-2.165 6.579-5.5v-.056C100.574 13.314 98.592 11.732 94.3 10.788z" style="fill:#fff"/><path d="M111.117 6.9a6.392 6.392.0 00-5.451 3.192V7.207h-2.12V26h2.12V18.81a6.411 6.411.0 005.451 3.054c3.442.0 6.8-2.776 6.8-7.467v-.056C117.917 9.622 114.531 6.9 111.117 6.9zm4.625 7.522c0 3.47-2.257 5.524-5.01 5.524a5.321 5.321.0 01-5.149-5.551v-.056a5.332 5.332.0 015.149-5.524c2.7.0 5.01 2.165 5.01 5.552z" style="fill:#fff"/><path d="M127.276 6.9a7.4 7.4.0 00-7.433 7.5v.055a7.323 7.323.0 007.378 7.44 7.422 7.422.0 007.461-7.495v-.056A7.346 7.346.0 00127.276 6.9zm5.231 7.55a5.276 5.276.0 01-5.231 5.524 5.364 5.364.0 01-5.258-5.579v-.056a5.279 5.279.0 015.2-5.552 5.412 5.412.0 015.286 5.608z" style="fill:#fff"/><path d="M144.784 9.1V7.207h-4.515V2.877h-2.12v4.33h-1.982V9.1h1.982v8.66c0 2.915 1.734 4.053 4.019 4.053a5.3 5.3.0 002.561-.611V19.366a4.427 4.427.0 01-2.065.5 2.114 2.114.0 01-2.395-2.387V9.1z" style="fill:#fff"/><path d="M152.794 3.044a7.024 7.024.0 012.064.36V1.545a6.384 6.384.0 00-2.34-.361 4.167 4.167.0 00-3.055 1.11 5.087 5.087.0 00-1.239 3.692V7.235h-1.955V9.1h1.955V21.558h2.12V9.1h4.487V7.263h-4.515V6.1C150.316 4.043 151.142 3.044 152.794 3.044z" style="fill:#fff"/><rect x="157.584" y="1.711" width="2.423" height="2.359" style="fill:#fff"/><rect x="157.75" y="7.207" width="2.092" height="14.351" style="fill:#fff"/><path d="M165.814 10.955V7.207h-2.12V21.558h2.12V15.84c0-4.33 2.533-6.578 5.644-6.578h.165V6.957A6.1 6.1.0 00165.814 10.955z" style="fill:#fff"/><path d="M185.719 14.508c0-4.219-2.423-7.606-6.635-7.606-3.937.0-6.827 3.331-6.827 7.5a7.113 7.113.0 007.1 7.495 7.326 7.326.0 005.865-2.693L183.9 18.005a5.869 5.869.0 01-4.487 2.027 4.991 4.991.0 01-5.011-4.775h11.287C185.719 14.924 185.719 14.7 185.719 14.508zM174.4 13.536c.3-2.776 2.175-4.83 4.625-4.83 2.808.0 4.3 2.221 4.542 4.83z" style="fill:#fff"/><path d="M81.876 2.005c0-.533-.415-.807-.973-.807H79.758V3.751h.486v-.88h.53l.6.88h.587l-.673-.966A.768.768.0 0081.876 2.005zm-1.016.462h-.616V1.631h.616c.329.0.515.144.515.418C81.375 2.294 81.189 2.467 80.86 2.467zM80.731.0a2.514 2.514.0 00-2.49 2.525V2.54a2.49 2.49.0 104.98-.015V2.511A2.493 2.493.0 0080.731.0zm2.2 2.525a2.2 2.2.0 11-4.408.015V2.525a2.2 2.2.0 114.408-.014z" style="fill:#fff"/></svg></span><span class="text-uppercase font-weight-bold"></span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/spotfire-mods/about/" ><span>About</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link active" href="/spotfire-mods/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/spotfire-mods/overview/" ><span>API Overview</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/spotfire-mods/api-docs/index.html" ><span>API Documentation</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center d-lg-none">
    

    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/spotfire-mods/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a>
  </li>
  <ul>
    <li class="collapse show" id="spotfire-modsdocs">
      
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-spotfire-modsdocsgetting-started" href="/spotfire-mods/docs/getting-started/">Getting started</a>
        
      
      
      
        
          






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/spotfire-mods/docs/using-the-api/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Using the API</a>
  </li>
  <ul>
    <li class="collapse show" id="spotfire-modsdocsusing-the-api">
      
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-spotfire-modsdocsusing-the-apiapi-overview" href="/spotfire-mods/docs/using-the-api/api-overview/">API overview</a>
        
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-spotfire-modsdocsusing-the-apiapi-docs" href="/spotfire-mods/docs/using-the-api/api-docs/">API documentation</a>
        
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-spotfire-modsdocsusing-the-apimod-data-views" href="/spotfire-mods/docs/using-the-api/mod-data-views/">Mod data views</a>
        
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-spotfire-modsdocsusing-the-apimod-schema" href="/spotfire-mods/docs/using-the-api/mod-schema/">Mod schema</a>
        
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page  active" id="m-spotfire-modsdocsusing-the-apiworking-with-readables" href="/spotfire-mods/docs/using-the-api/working-with-readables/">Mod reader</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
      
        
          






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/spotfire-mods/docs/tutorials/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Tutorials</a>
  </li>
  <ul>
    <li class="collapse " id="spotfire-modsdocstutorials">
      
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-spotfire-modsdocstutorialsbarchart-googlechart" href="/spotfire-mods/docs/tutorials/barchart-googlechart/">Create a bar chart using Google Charts</a>
        
      
      
      
        
          
          
          <a class="td-sidebar-link td-sidebar-link__page " id="m-spotfire-modsdocstutorialsmod-icons" href="/spotfire-mods/docs/tutorials/mod-icons/">Create an icon for your visualization mod</a>
        
      
      
    </li>
  </ul>
</ul>

        
      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            






<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">












<a href="https://github.com/TIBCOSoftware/spotfire-mods//issues/new?title=Working%20with%20mod%20readers" target="_blank"><i class="fab fa-github fa-fw"></i> Create documentation issue</a>


<a href="https://github.com/TIBCOSoftware/spotfire-mods//issues/new" target="_blank"><i class="fas fa-tasks fa-fw"></i> Create project issue</a>





</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#methods">Methods</a></li>
        <li><a href="#guidance-on-how-to-use-readers">Guidance on how to use readers</a></li>
      </ul>
    </li>
    <li><a href="#separating-initial-setup-from-updates">Separating initial setup from updates</a></li>
    <li><a href="#knowing-what-changed">Knowing what changed</a></li>
    <li><a href="#readables">Readables</a>
      <ul>
        <li><a href="#readableproxy">ReadableProxy</a></li>
      </ul>
    </li>
    <li><a href="#full-examples">Full examples</a></li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="/spotfire-mods/docs/">Documentation</a>
</li>




<li class="breadcrumb-item" >
	<a href="/spotfire-mods/docs/using-the-api/">Using the API</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/spotfire-mods/docs/using-the-api/working-with-readables/">Mod reader</a>
</li>

	</ol>
</nav	>

            



<p class="-text-primary pt-3 h6" >Reading time: 6 minutes and 45 seconds.</p>
<p>
<div class="td-content">
	<h1>Working with mod readers</h1>
    <div class="lead">This document gives an introduction to the mod <a href="/spotfire-mods/api-docs/interfaces/Reader.html">reader</a>.</div>
	       
	<p>The Spotfire Mod API exposes a set of <a href="/spotfire-mods/overview/#Readable">Readables</a>, such as the <a href="/spotfire-mods/api-docs/interfaces/DataView.html"><code>DataView</code></a> and <a href="/spotfire-mods/api-docs/interfaces/AnalysisProperty.html"><code>properties</code></a>. These can be consumed by a <a href="/spotfire-mods/api-docs/interfaces/Reader.html">Reader</a> in order to read their values and subscribe to changes.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">createReader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">property</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;myProperty&#34;</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">windowSize</span><span style="color:#000;font-weight:bold">());</span>
</code></pre></div><h2 id="introduction">Introduction</h2>
<!-- managing state, the callback will always be invoked with the latest up to date state. -->
<p>The aim of a <code>reader</code> is to simplify the synchronization of reading related values. An example is a visualization that depends on the window&rsquo;s <code>size</code> and the <code>dataview</code>. When one of the two changes, the visualization needs to be redrawn. The <code>reader</code> fetches new values and keeps unchanged values in memory.</p>
<p>The API exposes readables for the <a href="/spotfire-mods/api-docs/interfaces/DataView.html">Data</a>, <a href="/spotfire-mods/api-docs/interfaces/ModProperty.html">Properties</a>, <a href="/spotfire-mods/api-docs/interfaces/AnalysisProperty.html">Document Properties</a>, <a href="/spotfire-mods/api-docs/interfaces/Page.html">Pages</a>, <a href="/spotfire-mods/api-docs/interfaces/Size.html">Window size</a>, <a href="/spotfire-mods/api-docs/interfaces/Axis.html">Axes</a>, <a href="/spotfire-mods/api-docs/interfaces/DataTable.html">Tables</a> and <a href="/spotfire-mods/api-docs/interfaces/Column.html">Columns</a>.</p>
<h3 id="methods">Methods</h3>
<p>A <code>reader</code> has three methods; <code>subscribe</code>, <code>once</code> and <code>hasExpired</code>.</p>
<h4 id="subscribecallback"><code>subscribe(callback)</code></h4>
<p>Subscribe will be the most common way to work with <code>readables</code>. It sets up a subscription to new changes of the <code>readables</code> provided to the <code>reader</code>. When one or more <code>readables</code> gets updated on the server, the <code>reader</code> fetch all new values and invoke the provided <code>callback</code> with updated values.</p>
<p>The <code>reader</code> will only allow one <code>subscribe</code> <code>callback</code> to be active at a time. This means that the <code>callback</code> will finish executing before a new <code>callback</code> is scheduled. The following example shows how the <code>callback</code> will not be invoked again until its returning <code>promise</code> has settled. Even if the <code>dataView</code> is changed by marking or filtering. After the <code>callback</code> has finished executing, the <code>callback</code> is invoked again if there are any changed values. The <a href="/spotfire-mods/api-docs/interfaces/Reader.html#hasExpired"><code>hasExpired</code></a> method can be used to check whether any <code>readables</code> have been invalidated while the <code>callback</code> has been executing.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">reader</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">createReader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">visualization</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">());</span>

<span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">subscribe</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">render</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dataView</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span>
        <span style="color:#4e9a06">&#34;Subscribe callback invoked, &#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">dataView</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">allRows</span><span style="color:#000;font-weight:bold">()).</span><span style="color:#000">length</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34; rows. Start 3 seconds sleep.&#34;</span>
    <span style="color:#000;font-weight:bold">);</span>

    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3000</span><span style="color:#000;font-weight:bold">);</span>

    <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span>
        <span style="color:#4e9a06">&#34;Render callback finished.&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;Has the reader while the callback was executed: &#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">hasExpired</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">});</span>
</code></pre></div><p><img src="./subscribe.gif" alt="Demonstration of subscribe callback"></p>
<h4 id="oncecallback"><code>once(callback)</code></h4>
<p>When a developer wants to control the pace of updates, the <code>once</code> method can be used to wait for changes. <code>Once</code> will invoke its provided <code>callback</code> a single time, when one or more of the provided <code>readables</code> have changed.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">loopsRunning</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">reader</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">createReader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">visualization</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">());</span>

<span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">once</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">render</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dataView</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">loopsRunning</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">id</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">;</span>

    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">dataView</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">allRows</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span>
        <span style="color:#4e9a06">&#34;Render callback invoked with id: &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;. Currently &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">loopsRunning</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34; loops active.&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#4e9a06">&#34;schedule once() again and start 3 seconds sleep.&#34;</span>
    <span style="color:#000;font-weight:bold">);</span>

    <span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">once</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">render</span><span style="color:#000;font-weight:bold">);</span>

    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3000</span><span style="color:#000;font-weight:bold">);</span>

    <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Render callback finished with id:&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">id</span><span style="color:#000;font-weight:bold">);</span>

    <span style="color:#000">loopsRunning</span><span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">});</span>
</code></pre></div><p><img src="./once.gif" alt="Demonstration of once callback"></p>
<h4 id="hasexpired"><code>hasExpired()</code></h4>
<p>The <code>reader</code> keeps track of whether its readables are up to date or not. The <code>hasExpired</code> method can be invoked if you want to check whether all fetched values are up to date. This can be useful if your rendering loop takes a long time to complete and you want to quickly respond to changes.</p>
<p>The following example shows how a <code>reader</code> becomes expired after a mod property has been modified.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">reader</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">createReader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">property</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;myProperty&#34;</span><span style="color:#000;font-weight:bold">));</span>

<span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">once</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">render</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prop</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Render callback invoked &#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prop</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">());</span>

    <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">transaction</span><span style="color:#000;font-weight:bold">(</span>
        <span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000">prop</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;next value&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#204a87">Math</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">random</span><span style="color:#000;font-weight:bold">());</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#204a87;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span>
                <span style="color:#4e9a06">&#34;Transaction complete. Reader has expired: &#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">hasExpired</span><span style="color:#000;font-weight:bold">()</span>
            <span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">);</span>

    <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;End of callback. Reader has expired: &#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">hasExpired</span><span style="color:#000;font-weight:bold">());</span>
<span style="color:#000;font-weight:bold">});</span>
</code></pre></div><p>In this example the slow render loop is synthesized through a set of <code>sleep</code>s. Each time the mod is clicked, a mod property is updated and trigger a render loop. Since <code>subscribe</code> will only invoke the <code>callback</code> after it has finished, the <code>hasExpired</code> method can be used to trigger an early return of the render <code>callback</code>.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">reader</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">createReader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">property</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;myProperty&#34;</span><span style="color:#000;font-weight:bold">));</span>

<span style="color:#204a87">document</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">body</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">onclick</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Set new value for myProperty &#34;</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">property</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;myProperty&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;next value&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#204a87">Math</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">random</span><span style="color:#000;font-weight:bold">());</span>
<span style="color:#000;font-weight:bold">};</span>

<span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">subscribe</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">slowRender</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prop</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Slow render started &#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prop</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">());</span>
    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3000</span><span style="color:#000;font-weight:bold">);</span>

    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">hasExpired</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Reader has expired, return early to enter new loop&#34;</span><span style="color:#000;font-weight:bold">);</span>
        <span style="color:#204a87;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3000</span><span style="color:#000;font-weight:bold">);</span>

    <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;End of slow rendering&#34;</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">});</span>

<span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">sleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ms</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#204a87">Promise</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">res</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000">setTimeout</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">res</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ms</span><span style="color:#000;font-weight:bold">));</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(...</span><span style="color:#000">messages</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">div</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">document</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">createElement</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;div&#34;</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000">div</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">textContent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">messages</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34; &#34;</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#204a87">document</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">body</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">appendChild</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">div</span><span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000">div</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">scrollIntoView</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="guidance-on-how-to-use-readers">Guidance on how to use readers</h3>
<ul>
<li>
<p>If two or more <code>readables</code> depend on each other, they should be part of the same <code>reader</code>. Separating <code>readers</code> from a performance concern is often a pre-optimization. The <code>reader</code> is keeping unchanged values in memory and only changed values are fetched. If there is a performance concern it can be better to check <a href="#knowing-what-changed">which value has changed</a> through reference equality with the previous value.</p>
</li>
<li>
<p>If you need an initial setup, this can be done in a <code>once</code> <code>callback</code>, followed by setting up a <code>subscribe</code> <code>callback</code>.</p>
</li>
<li>
<p>Use <code>hasExpired()</code> when your render loop takes a long time, in order to respond quicker to changes.</p>
</li>
</ul>
<h2 id="separating-initial-setup-from-updates">Separating initial setup from updates</h2>
<p>If a mod needs some initial setup before starting to listen for changes, <a href="/spotfire-mods/api-docs/interfaces/Reader.html#once"><code>reader.once</code></a> can be used with a setup <code>callback</code>.</p>
<p>A <code>reader</code> will only trigger a new <code>callback</code> if any of its <code>Readables</code> has changed since it was last part of a <code>reader</code> <code>callback</code>. That means we can separate the setup from upcoming updates without triggering unnecessary <code>callbacks</code>.</p>
<p>In the following example, there are three <code>Readables</code>. They are first read together in an initial <code>once</code> <code>callback</code> as a setup for the mod. They are afterwards separated into two <code>readers</code>, one for the property and one for the rendering loop. Neither of the subscription <code>callbacks</code> will be invoked immediately. Instead they will wait until one of the <code>readables</code> change.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">setupReader</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">createReader</span><span style="color:#000;font-weight:bold">(</span>
    <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">visualization</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">(),</span>
    <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">windowSize</span><span style="color:#000;font-weight:bold">(),</span>
    <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">property</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;myProperty&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">);</span>

<span style="color:#000">setupReader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">once</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">dv</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">size</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prop</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;All values are read&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prop</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">());</span>

    <span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">propertyReader</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">createReader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">property</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;myProperty&#34;</span><span style="color:#000;font-weight:bold">));</span>
    <span style="color:#000">propertyReader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">subscribe</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">myProperty</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Property has changed to&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">myProperty</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">());</span>
    <span style="color:#000;font-weight:bold">});</span>

    <span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">renderReader</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">createReader</span><span style="color:#000;font-weight:bold">(</span>
        <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">visualization</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">(),</span>
        <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">windowSize</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000">renderReader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">subscribe</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">render</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dataView</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">windowSize</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span>
            <span style="color:#4e9a06">&#34;Render&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">dataView</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">allRows</span><span style="color:#000;font-weight:bold">()).</span><span style="color:#000">length</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#000">windowSize</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">height</span>
        <span style="color:#000;font-weight:bold">);</span>
    <span style="color:#000;font-weight:bold">});</span>

    <span style="color:#000">setInterval</span><span style="color:#000;font-weight:bold">(()</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000">prop</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;New value&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#204a87">Math</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">random</span><span style="color:#000;font-weight:bold">()),</span> <span style="color:#0000cf;font-weight:bold">2000</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">});</span>
</code></pre></div><p>A <code>readable</code> can only be part of one <code>reader</code> at a time. <code>subscribe</code> and <code>once</code> will not invoke the <code>callback</code> until the <code>readable</code> changes</p>
<h2 id="knowing-what-changed">Knowing what changed</h2>
<p>Sometimes you want to know what changed inside of a <code>subscribe</code> <code>callback</code>, often in order to improve the performance of the mod.</p>
<ul>
<li>Reference equality</li>
<li>Unchanged values are reused.</li>
</ul>
<p><em>Note</em>. It might be an unnecessary sub optimization to check for changes.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">reader</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">readerWithChangeChecker</span><span style="color:#000;font-weight:bold">(</span>
    <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">createReader</span><span style="color:#000;font-weight:bold">(</span>
        <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">visualization</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">(),</span>
        <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">windowSize</span><span style="color:#000;font-weight:bold">(),</span>
        <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">property</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;myProperty&#34;</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">);</span>

<span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">subscribe</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">async</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">dataview</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">size</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">prop</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">console</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Dataview&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">hasValueChanged</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dataview</span><span style="color:#000;font-weight:bold">));</span>
    <span style="color:#000">console</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;size&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">hasValueChanged</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">size</span><span style="color:#000;font-weight:bold">));</span>
    <span style="color:#000">console</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;property&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">hasValueChanged</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prop</span><span style="color:#000;font-weight:bold">));</span>
    <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">dataview</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">allRows</span><span style="color:#000;font-weight:bold">();</span>
    <span style="color:#000">setTimeout</span><span style="color:#000;font-weight:bold">(()</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000">prop</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;New value&#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#204a87">Math</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">random</span><span style="color:#000;font-weight:bold">()),</span> <span style="color:#0000cf;font-weight:bold">2000</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">});</span>

<span style="color:#8f5902;font-style:italic">/**
</span><span style="color:#8f5902;font-style:italic"> * Wrap a reader with an additional method called `hasChanged`.
</span><span style="color:#8f5902;font-style:italic"> * It allows you to check whether a value is new or unchanged since the last time the subscribe loop was called.
</span><span style="color:#8f5902;font-style:italic"> * @function
</span><span style="color:#8f5902;font-style:italic"> * @template A
</span><span style="color:#8f5902;font-style:italic"> * @param {A} reader
</span><span style="color:#8f5902;font-style:italic"> * @returns {A &amp; {hasValueChanged(value: any):boolean}}
</span><span style="color:#8f5902;font-style:italic"> */</span>
<span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">readerWithChangeChecker</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">reader</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">previousValues</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[];</span>
    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">currentValues</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[];</span>
    <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">compareWithPreviousValues</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cb</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">compareWithPreviousValues</span><span style="color:#000;font-weight:bold">(...</span><span style="color:#000">values</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000">previousValues</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">currentValues</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#000">currentValues</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">values</span><span style="color:#000;font-weight:bold">;</span>
            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">cb</span><span style="color:#000;font-weight:bold">(...</span><span style="color:#000">values</span><span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000;font-weight:bold">};</span>
    <span style="color:#000;font-weight:bold">}</span>

    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000;font-weight:bold">...</span><span style="color:#000">reader</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#000">subscribe</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cb</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#8f5902;font-style:italic">// @ts-ignore
</span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#000">reader</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">subscribe</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">compareWithPreviousValues</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cb</span><span style="color:#000;font-weight:bold">));</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#000">hasValueChanged</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">previousValues</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">indexOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">};</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h2 id="readables">Readables</h2>
<p>Every set of data that can be consumed through the Mod API is encapsulated in a <code>Readable</code>. A <code>Readable</code> can be seen as a <code>Promise</code> combined with an identifier. In contrast to <code>Promises</code>, which are eager, <code>Readables</code> are lazy. It is lazy because it does not immediately start fetching its promised value. It only fetches the value it encapsulates if it is awaited or the <code>then</code> method is invoked.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#8f5902;font-style:italic">// This does not fetch any value from the server
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">myPropertyReadable</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">property</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;myProperty&#34;</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000">console</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">myPropertyReadable</span><span style="color:#000;font-weight:bold">);</span>

<span style="color:#8f5902;font-style:italic">// This fetches the latest value from the server.
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">myProperty</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">await</span> <span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">property</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;myProperty&#34;</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000">console</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">myProperty</span><span style="color:#000;font-weight:bold">);</span>
</code></pre></div><h3 id="readableproxy">ReadableProxy</h3>
<p>If a value has synchronous methods, e.g a <a href="/spotfire-mods/api-docs/interfaces/ModProperty.html#set">mod property</a>, a <code>ReadableProxy</code> will be returned from the API instead of a <code>Readable</code>. The <code>ReadableProxy</code> is a <code>Readable</code> augmented with all synchronous methods of the encapsulated value, without the need to await the encapuslated value. This means a property can be set, without knowing its value.</p>
<!-- When the encapsulated value of a Readable has a set of methods, the API returns a ReadableProxy instead.  -->
<p>In the following example the mod property <code>myProperty</code> is modified without awaiting its encapsulated value.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#000">mod</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">property</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;myProperty&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;new value&#34;</span><span style="color:#000;font-weight:bold">);</span>
</code></pre></div><ul>
<li><code>ReadableProxy</code> augment a <code>Readable/Promise</code> with additional methods.</li>
<li>Methods are accessible without awaiting the <code>Readable</code>.</li>
<li>Value can be awaited. Will always fetch the latest up to date value.</li>
<li>Modifications should be done on user interaction, not directly in a <code>reader</code> callback.</li>
</ul>
<h2 id="full-examples">Full examples</h2>
<p>All examples can bee downloaded <a href="examples.js">here</a>. They can be tested with one of the existing examples, such as the <a href="https://github.com/TIBCOSoftware/spotfire-mods/tree/master/examples/js-dev-starter">js-dev-starter</a>.</p>

	
		<style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<div class="d-print-none">
<h2 class="feedback--title">Feedback</h2>
<p class="feedback--question">Was this page helpful?</p>
<button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it! Please <a href="https://github.com/TIBCOSoftware/spotfire-mods/issues/new">tell us how we can improve</a>.
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that. Please <a href="https://github.com/TIBCOSoftware/spotfire-mods/issues/new">tell us how we can improve</a>.
</p>
</div>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

		<br />
	
	
	<div class="text-muted mt-5 pt-3 border-top">Last modified November 13, 2020
</div>
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-4 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Facebook" aria-label="Facebook">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.facebook.com/TIBCO">
      <i class="fab fa-facebook"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://twitter.com/tibco">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Linkedin" aria-label="Linkedin">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/company/tibco/">
      <i class="fab fa-linkedin"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://github.com/TIBCOSoftware/spotfire-mods/">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="TIBCO Community" aria-label="TIBCO Community">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://community.tibco.com/s/article/TIBCO-Spotfire-Mods-Overview">
      <i class="fa fa-comment-alt"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 TIBCO Software Inc. All Rights Reserved</small>
        <small class="ml-1"><a href="https://www.tibco.com/company/terms-of-use" target="_blank">Privacy Policy</a></small>
	
		<p class="mt-2"><a href="/spotfire-mods/about/">About Spotfire Mods</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>











<script src="/spotfire-mods/js/main.min.fc448b19813d4fadb2cca28987d991692426ee27f66ce87690830854284c14ec.js" data-integrity="sha256-/ESLGYE9T62yzKKJh9mRaSQm7if2bOh2kIMIVChMFOw=" crossorigin="anonymous"></script>




  </body>
</html>